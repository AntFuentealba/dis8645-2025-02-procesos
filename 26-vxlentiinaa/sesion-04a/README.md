# sesion-04a

26-08-2025

## Apuntes

- Nos pasaron cajitas para guardar nuestros arduinos, las pantallas, cables, etc.
- También nos pasaron protoboards y la pantal SSD1306
- DigitalWrite: para leer los LEDS (input)
- AnalogRead: output

|Digital|Análogo|
|---|---|
|discreto|continuo|
|ej: hora|ej: tiempo|
|minecraft|mundo|
|pixel|foto|
|foto|analoga|

Usar el ejemplo del contador para que se vea las cosas en la pantalla

En esta clase avanzamos en nuestro proyecto, donde buscamos diferentes tipos de referentes para poder realizar un código. Primero nos guíamos del código visto en clases, para luego hacer ciertas modificaciones y lograr que se vea algo en la pantalla. Por otro lado, colocabamos imagenes ya hechas de [Wokwi Animator](https://animator.wokwi.com/) para entender un poco el movimiento y el código de la imagen. Acá cambiamos algunos parámetros, como:

```cpp
#define SCREEN_I2C_ADDR 0x3D
```
Se cambió a 

```cpp
#define SCREEN_I2C_ADDR 0x3C
```

![Wokwi](./imagenes/wokwiAnimator.png)

También empezamos a definir que era lo que queríamos hacer en nuestro proyecto, mis compañeras Sofía y Anto buscaron distintos tipos de poemas, comenzaron a realizar bocetos y buscar información. Sofia Cartes y yo comenzamos a intervenir el código principal para lograr distintas cosas y también buscamos información sobre algunos códigos de arduino.

- Código modificado:

```cpp
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define SCREEN_I2C_ADDR 0x3C // or 0x3C
#define SCREEN_WIDTH 128     // OLED display width, in pixels
#define SCREEN_HEIGHT 64     // OLED display height, in pixels
#define OLED_RST_PIN -1      // Reset pin (-1 if not available)

Adafruit_SSD1306 display(128, 64, &Wire, OLED_RST_PIN);

// OLED Animation: maneki
// Code auto-generated by https://wokwi.com/animator, graphics by icons8.com

#define FRAME_DELAY (42)
#define FRAME_WIDTH (64)
#define FRAME_HEIGHT (64)
#define FRAME_COUNT (sizeof(frames) / sizeof(frames[0]))
const byte PROGMEM frames[][512] = {
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,192,1,248,0,0,0,0,31,224,7,248,0,0,0,0,59,255,255,188...
}
};

void setup() {
  display.begin(SSD1306_SWITCHCAPVCC, SCREEN_I2C_ADDR);
}

int frame = 0;
void loop() {
  display.clearDisplay();
  display.drawBitmap(32, 0, frames[frame], FRAME_WIDTH, FRAME_HEIGHT, 1);
  display.display();
  frame = (frame + 1) % FRAME_COUNT;
  delay(FRAME_DELAY);
}
```

### Imágenes de los primeros poemas

Insertar imagenes

// declarar valor
// inicializar 0

int valorPot;

void setup() {
    Serial.begin(9600);
}

void loop() {
    // leer el valor analógico
    valorPot = analogRead(A0);
}

### Potenciómetro ¿Cómo colocar un potenciómetro al arduino?

![potenciómetro](./imagenes/analogVSdigital.jpg)

-El menor valor que puede hacer es 0 y el máximo es 1023.
  -Se escribe en digital y se lee en analógico.
  -Los comandos para escribir o leer en analóco y digital:

|Leer|-|
|---|---|
|Analógico|analogRead|
|Digital|digitalread()|

|Escribir|-|
|---|---|
|Analógico|analogWrite()|
|digital|digitalWrite()|

insertar imagenes de digital y analoga

```cpp
// declarar valor
// inicializar 0

int valorPot;

void setup() {
    Serial.begin(9600);
}

void loop() {
    // leer el valor analógico
    valorPot = analogRead(A0);

}
```

Código hecho en [Wokwi](https://wokwi.com/projects/440360994230097921)

```cpp
// declarar valor
// inicializar 0
int valorPot = 0;

String verso0;
String verso1;
String verso2;

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);

  verso0 = "ventilador";
  verso1 = "techo";
  verso2 = "lampara";

}

void loop() {
  // put your main code here, to run repeatedly:
  
  // leer el valor
  valorPot = analogRead(A0);

  if (valorPot < 300) {
    // aca esta entre 0 y 300-1
    Serial.println(verso0);
  }
  else if (valorPot < 600) {
    // aca esta entre 300 y 600
    Serial.println(verso1);
  } else {
    // aca esta mayor que 600
    Serial.println(verso2);
  }

  
  // Serial.println(valorPot);
}
```

![Potenciometro en Wokwi](./imagenes/potenciometroWokwi.png)

![Potenciometro en Wokwi](./imagenes/potenciometroWokwi-2.png)

### Imágenes de proceso en clases y en casa

- Primer código de proceso, este código es el ejemplo que utilizamos en clases, solo que le agregamos más ${\color{blue}String}$(): </br> para poder visualizar nuestro poema en el arduino. Utilizamos este ejemplo para entender como funcionaba el tema de los ${\color{blue}String}$(): </br> y así poder agregar más frases al código.

```cpp
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET -1
Adafruit_SSD1306 pantallita(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

int contador = 0;

String linea0;
String linea1;
String linea2;
String linea3;
String linea4;
String linea5;
String linea6;

void setup() {
  if(!pantallita.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
    Serial.println(F("No se encontró la pantalla SSD1306"));
    for(;;);
  }
  pantallita.clearDisplay();
  pantallita.setTextColor(SSD1306_WHITE);

  linea0 = "Casi cruzo la barrera";
  linea1 = "del espejo para ver";
  linea2 = "lo que no se puede ver";
  linea3 = "el mundo como seria";
  linea4 = "si la realidad copiara";
  linea5 = "y no al reves, el espejo";
  linea6 = "llena, porfin, de su nada.";
}

void loop() {
  pantallita.clearDisplay(); // Limpiamos toda la pantalla
  
  testscrolltext(linea0, 300);
  testscrolltext(linea1, 300);
  testscrolltext(linea2, 600);
  testscrolltext(linea3, 600);
  testscrolltext(linea4, 600);
  testscrolltext(linea5, 600);
  testscrolltext(linea6, 600);
  
  pantallita.display(); // Actualiza la pantalla


}


// void testscrolltext(void) {
  // cambiar la linea anterior
  // para agregar parametro String
  // de input
  // y tambien int para delays
  void testscrolltext(String texto, int pausa) {
  pantallita.clearDisplay();

  pantallita.setTextSize(2); // Draw 2X-scale text
  pantallita.setTextColor(SSD1306_WHITE);
  pantallita.setCursor(10, 0);
  // pantallita.println(F("scroll"));
  // mod que le hice yo
  pantallita.println(texto);

  pantallita.display();      // Show initial text
  delay(100);

  // Scroll in various directions, pausing in-between:
  pantallita.startscrollright(0x00, 0x0F);
  delay(pausa);
  pantallita.stopscroll();
  delay(pausa);
  pantallita.startscrollleft(0x00, 0x0F);
  delay(pausa);
  pantallita.stopscroll();
  delay(pausa);
  pantallita.startscrolldiagright(0x00, 0x07);
  delay(pausa);
  pantallita.startscrolldiagleft(0x00, 0x07);
  delay(pausa);
  pantallita.stopscroll();
  delay(pausa);
}
```
agregar foto proceso uno

- Segundo código de proceso, donde comenzamos a trabajar con el espiral, entiendo como iban los parámetros de la fórmula aplicada y ver en que podíamos ajustarla

```cpp
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET -1
Adafruit_SSD1306 pantallita(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

String lineas[7];

int cx = SCREEN_WIDTH / 2;   // centro de la pantalla en X
int cy = SCREEN_HEIGHT / 2;  // centro en Y

void setup() {
  if(!pantallita.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
    for(;;); // si no detecta la pantalla, se queda aquí
  }

  pantallita.clearDisplay();
  pantallita.setTextColor(SSD1306_WHITE);
  pantallita.setTextSize(1);

  // Poema escrito en varias lineas
  lineas[0] = "Casi cruzo la barrera";
  lineas[1] = "del espejo para ver";
  lineas[2] = "lo que no se puede ver";
  lineas[3] = "el mundo como seria";
  lineas[4] = "si la realidad copiara";
  lineas[5] = "y no al reves, el espejo";
  lineas[6] = "llena, porfin, de su nada.";
}

void loop() {
  pantallita.clearDisplay();

  // aca se une todas las lineas en un solo string largo
  String poema = "";
  for (int i = 0; i < 7; i++) {
    poema += lineas[i] + " ";
  }

  mostrarPoemaEspiral(poema);

  delay(5000); // aca es donde se espera para volver a reiniciar el codigo
}

// función que escribe el poema en espiral
void mostrarPoemaEspiral(String texto) {
  float r = 5;          // radio inicial
  float dr = 2;         // aumento de radio
  float theta = 0;      // ángulo inicial
  float dtheta = 0.4;   // cuánto avanza el ángulo por letra

  for (int i = 0; i < texto.length(); i++) {
    int x = cx + r * cos(theta);
    int y = cy + r * sin(theta);

    // asegurar que no se salga de la pantalla
    if (x >= 0 && x < SCREEN_WIDTH - 6 && y >= 0 && y < SCREEN_HEIGHT - 8) {
      pantallita.setCursor(x, y);
      pantallita.write(texto[i]);
      pantallita.display();
    }

    delay(120);   // velocidad en la que aparece el espiral

    theta += dtheta;
    r += dr * dtheta / (2 * PI);
  }
}
```

agregar foto proceso dos

Acá cambiamos estos parámetros para editar el espiral 

agregar foto proceso 2.1

agregar foto proceso 2.2

```cpp
 // función que escribe el poema en espiral
void mostrarPoemaEspiral(String texto) {
  float r = 5;          // radio inicial
  float dr = 2;         // aumento de radio
  float theta = 0;      // ángulo inicial
  float dtheta = 0.4;   // cuánto avanza el ángulo por letra
```

- Al hacer el código anterior, preguntamos a un estudiante de informática y nos dió este código

```cpp
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET -1
Adafruit_SSD1306 pantallita(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

// Líneas del poema
String linea0;
String linea1;
String linea2;
String linea3;
String linea4;
String linea5;
String linea6;

// Centro de la pantalla
int cx = SCREEN_WIDTH / 2;
int cy = SCREEN_HEIGHT / 2;

// Parámetros de la espiral
float r = 5;          // radio inicial
float dr = 3.5;       // incremento de radio
float theta = 0;      // ángulo inicial
float dtheta = 0.7;   // incremento angular

// Buffer de letras para efecto "agujero negro"
struct Letra {
  char c;
  int x;
  int y;
};
const int maxLetras = 100; // máximo de letras visibles
Letra espiral[maxLetras];
int inicio = 0;
int fin = 0;

void setup() {
  if(!pantallita.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
    Serial.println(F("No se encontró la pantalla SSD1306"));
    for(;;);
  }
  pantallita.clearDisplay();
  pantallita.setTextColor(SSD1306_WHITE);
  pantallita.setTextSize(1);

  // Inicializamos el poema
  linea0 = "Casi cruzo la barrera";
  linea1 = "del espejo para ver";
  linea2 = "lo que no se puede ver";
  linea3 = "el mundo como seria";
  linea4 = "si la realidad copiara";
  linea5 = "y no al reves, el espejo";
  linea6 = "llena, porfin, de su nada.";
}

void loop() {
  // Unir todas las líneas en un solo texto
  String poema = "";
  poema += linea0 + " ";
  poema += linea1 + " ";
  poema += linea2 + " ";
  poema += linea3 + " ";
  poema += linea4 + " ";
  poema += linea5 + " ";
  poema += linea6 + " ";

  mostrarPoemaEspiral(poema);

  delay(3000); // espera antes de repetir la animación
}

// Función que dibuja la espiral con efecto "agujero negro"
void mostrarPoemaEspiral(String texto) {
  for (int i = 0; i < texto.length(); i++) {
    int x = cx + r * cos(theta);
    int y = cy + r * sin(theta);

    // Guardar la letra en el buffer
    espiral[fin] = {texto[i], x, y};
    fin = (fin + 1) % maxLetras;

    // Si el buffer se llena, mover inicio para borrar la letra más antigua
    if (fin == inicio) {
      inicio = (inicio + 1) % maxLetras;
    }

    // Limpiar pantalla
    pantallita.clearDisplay();

    // Dibujar todas las letras visibles
    int idx = inicio;
    while (idx != fin) {
      pantallita.setCursor(espiral[idx].x, espiral[idx].y);
      pantallita.write(espiral[idx].c);
      idx = (idx + 1) % maxLetras;
    }

    pantallita.display();
    delay(100); // velocidad de animación

    // Actualizar espiral
    theta += dtheta;
    r += dr * dtheta / (2 * 3.1416);
  }
}
```
